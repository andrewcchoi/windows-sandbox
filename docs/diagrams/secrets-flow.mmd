flowchart TD
    Start([Need to use secrets]) --> Type{Secret Type?}

    Type -->|Development| DevFlow
    Type -->|Build-time| BuildFlow
    Type -->|Runtime Production| RuntimeFlow
    Type -->|Cloud CLI Config| CloudFlow

    subgraph DevFlow["Development Secrets"]
        D1[VS Code Input Variables]
        D2[User prompted at startup]
        D3[Not persisted in repo]
        D4[Example: API keys for testing]
        D1 --> D2 --> D3 --> D4
        D4 --> DevResult[devcontainer.json:<br/>remoteEnv with inputs]
    end

    subgraph BuildFlow["Build-time Secrets"]
        B1[Docker Build Secrets]
        B2[Mounted during build only]
        B3[Not in image layers]
        B4[Example: Private repo credentials]
        B1 --> B2 --> B3 --> B4
        B4 --> BuildChoice{Method?}
        BuildChoice -->|File mount| B5[--secret id=mysecret,src=path]
        BuildChoice -->|SSH agent| B6[--ssh default]
        B5 --> BuildResult[Never in ARG/ENV]
        B6 --> BuildResult
    end

    subgraph RuntimeFlow["Production Runtime Secrets"]
        R1[Docker Runtime Secrets]
        R2[tmpfs mount in memory]
        R3[Not in environment vars]
        R4[Example: Database passwords]
        R1 --> R2 --> R3 --> R4
        R4 --> RuntimeResult[docker-compose.yml:<br/>secrets: db_password]
    end

    subgraph CloudFlow["Cloud CLI Credentials"]
        Cl1[Host Config Mounts]
        Cl2[Read-only bind mounts]
        Cl3[Credentials stay on host]
        Cl4[Example: ~/.aws, ~/.config/gcloud]
        Cl1 --> Cl2 --> Cl3 --> Cl4
        Cl4 --> CloudResult[docker-compose.yml:<br/>- ~/.aws:/tmp/host-aws:ro]
    end

    DevResult --> Lifecycle[Secret Lifecycle]
    BuildResult --> Lifecycle
    RuntimeResult --> Lifecycle
    CloudResult --> Lifecycle

    subgraph Lifecycle["Lifecycle Management"]
        L1[1. Creation:<br/>Generate/receive secret]
        L2[2. Storage:<br/>Secret manager or secure file]
        L3[3. Distribution:<br/>Method selected above]
        L4[4. Usage:<br/>Application reads secret]
        L5[5. Rotation:<br/>Update regularly]
        L6[6. Revocation:<br/>Remove when no longer needed]
        L1 --> L2 --> L3 --> L4 --> L5 --> L6
    end

    Lifecycle --> AntiPatterns

    subgraph AntiPatterns["‚ùå Anti-Patterns to Avoid"]
        A1[ARG in Dockerfile<br/>visible in docker history]
        A2[ENV in Dockerfile<br/>visible in docker inspect]
        A3[Hardcoded in code<br/>committed to git]
        A4[.env files in repo<br/>accidentally committed]
        A5[Logs containing secrets<br/>CloudWatch, files]
    end

    AntiPatterns --> Done([Secure Secret Management])

    style Start fill:#FFE4B5,stroke:#333,stroke-width:2px
    style Done fill:#90EE90,stroke:#333,stroke-width:2px
    style Type fill:#FFE4B5,stroke:#333,stroke-width:2px
    style BuildChoice fill:#FFE4B5,stroke:#333,stroke-width:2px
    style DevFlow fill:#87CEEB,stroke:#333,stroke-width:2px
    style BuildFlow fill:#DDA0DD,stroke:#333,stroke-width:2px
    style RuntimeFlow fill:#FFB366,stroke:#333,stroke-width:2px
    style CloudFlow fill:#90EE90,stroke:#333,stroke-width:2px
    style Lifecycle fill:#FFE4B5,stroke:#333,stroke-width:2px
    style AntiPatterns fill:#FF6B6B,stroke:#333,stroke-width:2px
